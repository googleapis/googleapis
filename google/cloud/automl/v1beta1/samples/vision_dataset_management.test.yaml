test:
  suites:
  - name: Vision Dataset Management (Create, Get, List, Delete)
    
    # This includes one test which walks through Create, List, Delete, etc.

    setup:
    - env: {name: GOOGLE_PROJECT_ID, variable: project_id}
    - code: dataset_name = "a" + uuid().replace("-", "")[:30]

    cases:
    - name: Vision Classification
      spec:
      # LIST (assert does not exist)
      - call:
          sample: automl_vision_list_datasets
          params:
            project: { variable: project_id }
      - assert_not_contains:
        - variable: dataset_name

      # CREATE
      - call:
          sample: automl_vision_create_dataset
          params:
            project: { variable: project_id }
            display_name: { variable: dataset_name }
      - extract_match:
          pattern: datasets/([^\s]+)
          variable: dataset_id
      - assert_contains:
        - literal: "Dataset name"
        - variable: dataset_name
        - literal: "Image classification dataset metadata type: MULTILABEL"

      # LIST (assert does exist)
      - call:
          sample: automl_vision_list_datasets
          params:
            project: { variable: project_id }
      - assert_contains:
        - literal: "Dataset name"
        - variable: dataset_name
        - variable: dataset_id
        - literal: "Image classification dataset metadata type: MULTILABEL"

      # GET
      - call:
          sample: automl_vision_get_dataset
          params:
            project: { variable: project_id }
            dataset_id: { variable: dataset_id }
      - assert_contains:
        - literal: "Dataset name"
        - variable: dataset_name
        - variable: dataset_id
        - literal: "Image classification dataset metadata type: MULTILABEL"

      # DELETE
      - log: ["Deleting dataset (may take a minute)"]
      - call:
          sample: automl_vision_delete_dataset
          params:
            project: { variable: project_id }
            dataset_id: { variable: dataset_id }
      - assert_contains:
        - literal: "Deleted dataset"

      # LIST (assert does not exist)
      - call:
          sample: automl_vision_list_datasets
          params:
            project: { variable: project_id }
      - assert_not_contains:
        - variable: dataset_name
        - variable: dataset_id
