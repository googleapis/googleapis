// Copyright 2025 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package google.cloud.databasecenter.v1beta;

import "google/api/annotations.proto";
import "google/api/client.proto";
import "google/api/field_behavior.proto";
import "google/cloud/databasecenter/v1beta/machine_config.proto";
import "google/cloud/databasecenter/v1beta/maintenance.proto";
import "google/cloud/databasecenter/v1beta/metric_data.proto";
import "google/cloud/databasecenter/v1beta/product.proto";
import "google/cloud/databasecenter/v1beta/signals.proto";

option csharp_namespace = "Google.Cloud.DatabaseCenter.V1Beta";
option go_package = "cloud.google.com/go/databasecenter/apiv1beta/databasecenterpb;databasecenterpb";
option java_multiple_files = true;
option java_outer_classname = "ServiceProto";
option java_package = "com.google.cloud.databasecenter.v1beta";
option php_namespace = "Google\\Cloud\\DatabaseCenter\\V1beta";
option ruby_package = "Google::Cloud::DatabaseCenter::V1beta";

// DatabaseCenter contains methods to query fleet view for database resources.
service DatabaseCenter {
  option (google.api.default_host) = "databasecenter.googleapis.com";
  option (google.api.oauth_scopes) =
      "https://www.googleapis.com/auth/cloud-platform";

  // QueryProducts provides a list of all possible products which can be used to
  // filter database resources.
  rpc QueryProducts(QueryProductsRequest) returns (QueryProductsResponse) {
    option (google.api.http) = {
      get: "/v1beta:queryProducts"
    };
  }

  // QueryDatabaseResourceGroups returns paginated results of database groups.
  rpc QueryDatabaseResourceGroups(QueryDatabaseResourceGroupsRequest)
      returns (QueryDatabaseResourceGroupsResponse) {
    option (google.api.http) = {
      post: "/v1beta:queryDatabaseResourceGroups"
      body: "*"
    };
  }
}

// The enum value corresponds to 'type' suffix in the resource_type field.
enum ResourceCategory {
  // Unspecified.
  RESOURCE_CATEGORY_UNSPECIFIED = 0;

  // A resource that is an Instance.
  INSTANCE = 1;

  // A resource that is a Cluster.
  CLUSTER = 2;

  // A resource that is a Database.
  DATABASE = 3;
}

// Proto representing the edition of the instance.
// NextId: 4.
enum Edition {
  // Default, to make it consistent with instance edition enum.
  EDITION_UNSPECIFIED = 0;

  // Represents the enterprise edition.
  EDITION_ENTERPRISE = 1;

  // Represents the enterprise plus edition.
  EDITION_ENTERPRISE_PLUS = 2;

  // Represents the standard edition.
  EDITION_STANDARD = 3;
}

// SubResourceType refers to the sub-type of database resource.
enum SubResourceType {
  // Unspecified.
  SUB_RESOURCE_TYPE_UNSPECIFIED = 0;

  // A resource acting as a primary.
  SUB_RESOURCE_TYPE_PRIMARY = 1;

  // A resource acting as a secondary.
  SUB_RESOURCE_TYPE_SECONDARY = 2;

  // A resource acting as a read-replica.
  SUB_RESOURCE_TYPE_READ_REPLICA = 3;

  // A resource acting as an external primary.
  SUB_RESOURCE_TYPE_EXTERNAL_PRIMARY = 5;

  // For the rest of the categories.
  SUB_RESOURCE_TYPE_OTHER = 4;
}

// QueryProductsRequest is the request to get a list of products.
message QueryProductsRequest {
  // Required. Parent can be a project, a folder, or an organization.
  //
  // The allowed values are:
  //
  // * projects/{PROJECT_ID}/locations/{LOCATION}
  // (e.g.,"projects/foo-bar/locations/us-central1")
  // * projects/{PROJECT_NUMBER}/locations/{LOCATION}
  // (e.g.,"projects/12345678/locations/us-central1")
  // * folders/{FOLDER_NUMBER}/locations/{LOCATION}
  // (e.g.,"folders/1234567/locations/us-central1")
  // * organizations/{ORGANIZATION_NUMBER}/locations/{LOCATION}
  // (e.g.,"organizations/123456/locations/us-central1")
  // * projects/{PROJECT_ID} (e.g., "projects/foo-bar")
  // * projects/{PROJECT_NUMBER} (e.g., "projects/12345678")
  // * folders/{FOLDER_NUMBER} (e.g., "folders/1234567")
  // * organizations/{ORGANIZATION_NUMBER} (e.g., "organizations/123456")
  string parent = 3 [(google.api.field_behavior) = REQUIRED];

  // Optional. If unspecified, at most 50 products will be returned.
  // The maximum value is 1000; values above 1000 will be coerced to 1000.
  int32 page_size = 1 [(google.api.field_behavior) = OPTIONAL];

  // Optional. A page token, received from a previous `ListLocations` call.
  // Provide this to retrieve the subsequent page.
  // All other parameters except page size should match the call that provided
  // the page page token.
  string page_token = 2 [(google.api.field_behavior) = OPTIONAL];
}

// QueryProductsResponse represents the response containing a list of products.
message QueryProductsResponse {
  // List of database products returned.
  repeated Product products = 1;

  // A token that can be sent as `page_token` to retrieve the next page.
  // If this field is omitted, there are no subsequent pages
  string next_page_token = 2;

  // Unordered list. List of unreachable regions from where data could not be
  // retrieved.
  repeated string unreachable = 3
      [(google.api.field_behavior) = UNORDERED_LIST];
}

// QueryDatabaseResourceGroupsRequest is the request to get a list of database
// groups.
message QueryDatabaseResourceGroupsRequest {
  // Required. Parent can be a project, a folder, or an organization. The search
  // is limited to the resources within the `scope`.
  //
  // The allowed values are:
  //
  // * projects/{PROJECT_ID} (e.g., "projects/foo-bar")
  // * projects/{PROJECT_NUMBER} (e.g., "projects/12345678")
  // * folders/{FOLDER_NUMBER} (e.g., "folders/1234567")
  // * organizations/{ORGANIZATION_NUMBER} (e.g., "organizations/123456")
  string parent = 1 [(google.api.field_behavior) = REQUIRED];

  // Optional. The expression to filter resources.
  //
  // The following fields are filterable:
  //   * full_resource_name
  //   * resource_type
  //   * container
  //   * product.type
  //   * product.engine
  //   * product.version
  //   * location
  //   * labels
  //   * resource_category
  //   * machine_config.cpu_count
  //   * machine_config.memory_size_bytes
  //   * machine_config.shard_count
  //   * resource_name
  //   * tags
  //   * backupdr_config.backupdr_managed
  //   * edition
  //
  // The expression is a list of zero or more restrictions combined via logical
  // operators `AND` and `OR`. When `AND` and `OR` are both used in the
  // expression, parentheses must be appropriately used to group the
  // combinations.
  //
  // Example: location="us-east1"
  // Example: container="projects/123" OR container="projects/456"
  // Example: (container="projects/123" OR
  //           container="projects/456") AND location="us-east1"
  // Example: full_resource_name=~"test"
  // Example: full_resource_name=~"test.*master"
  string filter = 2 [(google.api.field_behavior) = OPTIONAL];

  // Optional. Groups of signal types that are requested.
  repeated SignalTypeGroup signal_type_groups = 3
      [(google.api.field_behavior) = OPTIONAL];

  // Optional. Filters based on signals. The list will be ORed together and then
  // ANDed with the `filters` field above.
  repeated SignalFilter signal_filters = 4
      [(google.api.field_behavior) = OPTIONAL];

  // Optional. A field that specifies the sort order of the results.
  //
  // The following fields are sortable:
  //   * full_resource_name
  //   * product.type
  //   * product.engine
  //   * product.version
  //   * container
  //   * issue_count
  //   * machine_config.vcpu_count
  //   * machine_config.memory_size_bytes
  //   * machine_config.shard_count
  //   * resource_name
  //   * issue_severity
  //   * signal_type
  //   * location
  //   * resource_type
  //   * instance_type
  //   * edition
  //   * metrics.p99_cpu_utilization
  //   * metrics.p95_cpu_utilization
  //   * metrics.current_storage_used_bytes
  //   * metrics.node_count
  //   * metrics.processing_unit_count
  //   * metrics.current_memory_used_bytes
  //   * metrics.peak_storage_utilization
  //   * metrics.peak_number_connections
  //   * metrics.peak_memory_utilization
  //
  // The default order is ascending. Add "DESC" after the field name to indicate
  // descending order. Add "ASC" after the field name to indicate ascending
  // order. It only supports a single field at a time.
  //
  // For example:
  //  order_by = "full_resource_name" sorts response in ascending order
  //  order_by = "full_resource_name DESC" sorts response in descending order
  //  order_by = "issue_count DESC" sorts response in descending order of
  //  count of all issues associated with a resource.
  //
  // More explicitly, order_by = "full_resource_name, product" is not supported.
  string order_by = 5 [(google.api.field_behavior) = OPTIONAL];

  // Optional. If unspecified, at most 50 resource groups will be returned.
  // The maximum value is 1000; values above 1000 will be coerced to 1000.
  int32 page_size = 6 [(google.api.field_behavior) = OPTIONAL];

  // Optional. A page token, received from a previous
  // `QueryDatabaseResourceGroupsRequest` call. Provide this to retrieve the
  // subsequent page. All parameters except page_token should match the
  // parameters in the call that provided the page page token.
  string page_token = 7 [(google.api.field_behavior) = OPTIONAL];
}

// QueryDatabaseResourceGroupsResponse represents the response message
// containing a list of resource groups.
message QueryDatabaseResourceGroupsResponse {
  // List of database resource groups that pass the filter.
  repeated DatabaseResourceGroup resource_groups = 1;

  // A token that can be sent as `page_token` to retrieve the next page.
  // If this field is omitted, there are no subsequent pages.
  string next_page_token = 2;

  // Unordered list. List of unreachable regions from where data could not be
  // retrieved.
  repeated string unreachable = 3
      [(google.api.field_behavior) = UNORDERED_LIST];
}

// DatabaseResourceGroup represents all resources that serve a common data set.
// It is considered notionally as a single entity, powered by any number of
// units of compute and storage.
message DatabaseResourceGroup {
  // A database resource that serves as a root of the group of database
  // resources. It is repeated just in case we have the concept of multiple
  // roots in the future, however, it will only be populated with a single value
  // for now.
  repeated DatabaseResource root_resources = 1;

  // The filtered signal groups and the count of issues associated with the
  // resources that have been filtered in.
  repeated IssueCount signal_groups = 2;
}

// DatabaseResource represents every individually configured database unit
// representing compute and/or storage.
// NextId: 20
message DatabaseResource {
  // List of children associated with a database group.
  repeated DatabaseResource child_resources = 1;

  // The full resource name, based on CAIS resource name format
  // https://cloud.google.com/asset-inventory/docs/resource-name-format
  //
  // Example:
  //
  //  `//cloudsql.googleapis.com/projects/project-number/instances/mysql-1`
  //  `//cloudsql.googleapis.com/projects/project-number/instances/postgres-1`
  //  `//spanner.googleapis.com/projects/project-number/instances/spanner-instance-1`
  //  `//alloydb.googleapis.com/projects/project-number/locations/us-central1/clusters/c1`
  //  `//alloydb.googleapis.com/projects/project-number/locations/us-central1/clusters/c1/instances/i1`
  string full_resource_name = 3;

  // Specifies where the resource is created. For GCP, it is the full name of
  // the project.
  string container = 4;

  // The product this resource represents.
  Product product = 5;

  // The location of the resources. It supports returning only regional
  // locations in GCP. These are of the form: "us-central1", "us-east1", etc.
  // See https://cloud.google.com/about/locations for a list of such regions.
  string location = 6;

  // Labels applied on the resource. The requirements for labels assigned to
  // Google Cloud resources may be found at
  // https://cloud.google.com/resource-manager/docs/labels-overview#requirements
  repeated Label labels = 7;

  // Tags applied on the resource. The requirements for tags assigned to
  // Google Cloud resources may be found at
  // https://cloud.google.com/resource-manager/docs/tags/tags-overview
  repeated Tag tags = 16;

  // The type of resource defined according to the pattern:
  // {Service Name}/{Type}. Ex:
  // sqladmin.googleapis.com/Instance
  // alloydb.googleapis.com/Cluster
  // alloydb.googleapis.com/Instance
  // spanner.googleapis.com/Instance
  string resource_type = 8;

  // Subtype of the resource specified at creation time.
  SubResourceType sub_resource_type = 9;

  // Machine configuration like CPU, memory, etc for the resource.
  MachineConfig machine_config = 12;

  // The list of signal groups and count of issues related to the resource.
  // Only those signals which have been requested would be included.
  repeated SignalGroup signal_groups = 10;

  // Observable metrics for the resource e.g. CPU utilization, memory
  // utilization, etc.
  Metrics metrics = 13;

  // The category of the resource.
  ResourceCategory resource_category = 14;

  // The name of the resource(The last part of the full resource name).
  // Example:
  // For full resource name -
  // `//cloudsql.googleapis.com/projects/project-number/instances/mysql-1`,
  // resource name - `mysql-1`
  // For full resource name -
  // `//cloudsql.googleapis.com/projects/project-number/instances/postgres-1` ,
  // resource name - `postgres-1`
  // Note: In some cases, there might be more than one resource with the same
  // resource name.
  string resource_name = 15;

  // Optional. Backup and disaster recovery details for the resource.
  BackupDRConfig backupdr_config = 17 [(google.api.field_behavior) = OPTIONAL];

  // The edition of the resource.
  Edition edition = 18;

  // Optional. The maintenance information of the resource.
  MaintenanceInfo maintenance_info = 19
      [(google.api.field_behavior) = OPTIONAL];
}

// Label is a key value pair applied to a resource.
message Label {
  // The key part of the label.
  string key = 1;

  // The value part of the label.
  string value = 2;

  // The source of the Label. Source is empty if the label is directly attached
  // to the resource and not inherited.
  string source = 3;
}

// BackupDRConfig to capture the backup and disaster recovery details of
// database resource.
message BackupDRConfig {
  // Indicates if the resource is managed by BackupDR.
  optional bool backupdr_managed = 1;
}

// Tag is a key value pair attached to a resource.
message Tag {
  string key = 1;

  // The value part of the tag.
  string value = 2;

  // The source of the tag. According to
  // https://cloud.google.com/resource-manager/docs/tags/tags-overview#tags_and_labels,
  // tags can be created only at the project or organization level. Tags can be
  // inherited from different project as well not just the current project where
  // the database resource is present.
  // Format:
  // "projects/{PROJECT_ID}",
  // "projects/{PROJECT_NUMBER}",
  // "organizations/{ORGANIZATION_ID}"
  string source = 3;

  // Indicates the inheritance status of a tag value
  // attached to the given resource. If the tag value is inherited from one of
  // the resource's ancestors, inherited will be true. If false, then the tag
  // value is directly attached to the resource.
  bool inherited = 4;
}
